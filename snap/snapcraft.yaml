name: bbcb-cpc
title: BlackBox-CPC IDE (WINE)
base: core18
version: 1.8.2111
license: BSD-2-Clause
icon: snap/gui/blackbox.svg
summary: Component Pascal Collection version of IDE BlackBox Component Builder
description: |
  The WinAPI-based legacy-friendly version of BlackBox Component Builder, compatible with a lot of
  extensions from Helmut Zinn's Component Pascal Collection.
  BlackBox is open-source IDE and a framework (collection of modules)
  written in the programming language Component Pascal which is a descendant of languages
  Oberon←Modula-2←Pascal developed by Niklaus Wirth.
  BlackBox provides facilities for document creation,
  program compilation, module execution, and interface design. Component Pascal is module
  based. Each module is a unit of compilation and a unit of execution. There is no explicit
  linker. Modules are brought into memory when specified. There is no need for "header"
  files. Symbol files are automatically generated by the compiler for those elements of a
  module that are specifically marked to be exported.
  The component classes (e.g. for text or form components) follow the principle of black box
  inheritance (interface inheritance instead of implementation inheritance), hence the name
  "BlackBox".
  The compiler is very fast. The language is strongly typed. Data structures are automatically
  garbage collected when no longer referenced. The framework comes with a complete set of
  documents explaining the meaning and use of each module.
  Note: to view BlackBox documents in the terminal, recommended to use odcread.

grade: stable
confinement: strict

architectures:
  - build-on: amd64
  - build-on: i386

parts:
  # The sommelier script helps you snap Windows applications using Wine. It
  # initializes and configures Wine and installs the Windows application.
  sommelier:
    plugin: make
    source: https://github.com/snapcrafters/sommelier-core.git
    source-branch: "1.0"

  run:
    source: ./snap/local
    plugin: nil
    override-build: |
      mkdir -p $SNAPCRAFT_PART_INSTALL/usr/bin \
               $SNAPCRAFT_PART_INSTALL/usr/lib/blackbox-cpc/System/Code \
               $SNAPCRAFT_PART_INSTALL/usr/lib/blackbox-cpc/Host/Code
      cp run $SNAPCRAFT_PART_INSTALL/usr/bin/
      cp System/Code/Config.ocf $SNAPCRAFT_PART_INSTALL/usr/lib/blackbox-cpc/System/Code/
      cp Host/Code/Cmds.ocf     $SNAPCRAFT_PART_INSTALL/usr/lib/blackbox-cpc/Host/Code/
      cp -r Desktop $SNAPCRAFT_PART_INSTALL/usr/lib/blackbox-cpc/

  blackbox:
    source: http://www.zinnamturm.eu/pac/BlackBox-2111-core.7z
    plugin: nil
    override-build: |
      mkdir -p $SNAPCRAFT_PART_INSTALL/usr/lib/blackbox-cpc
      cp -r * $SNAPCRAFT_PART_INSTALL/usr/lib/blackbox-cpc/
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/blackbox-cpc/System/Code/Config.ocf
      rm $SNAPCRAFT_PART_INSTALL/usr/lib/blackbox-cpc/Host/Code/Cmds.ocf
      rm -r $SNAPCRAFT_PART_INSTALL/usr/lib/blackbox-cpc/*/Rsrc/ru

  russian:
    source: https://github.com/bbcb/russian.git
    plugin: nil
    override-build: |
      mkdir -p $SNAPCRAFT_PART_INSTALL/usr/lib/blackbox-cpc
      cp -r * $SNAPCRAFT_PART_INSTALL/usr/lib/blackbox-cpc/
      cd $SNAPCRAFT_PART_INSTALL/usr/lib/blackbox-cpc
      rm README links.sh make-deb.sh

environment:
  WINEDLLOVERRIDES: "mscoree,mshtml="
  GTK_USE_PORTAL: '1'

apps:
  bbcb-cpc:
    extensions: [ gnome-3-28 ]
    command: usr/bin/run
    plugs:
      - home
      - desktop
      - cups-control
      - network
      - hardware-observe
      - removable-media
  # The wine command can be used to run applications inside the wine
  # environment that this snap uses.
  #
  # For example, users can configure the wine environment of this snap
  # by running `bbcn-cpc.wine winecfg`.
  wine:
    extensions: [ gnome-3-28 ]
    command: bin/sommelier
    plugs:
      - home
      - network
      - hardware-observe
      - process-control
      - cups-control
      - removable-media
  # The winetricks command can be used to run winetricks inside the wine
  # environment that this snap uses.
  winetricks:
    extensions: [ gnome-3-28 ]
    command: bin/sommelier winetricks
    plugs:
      - network

plugs:
  wine-runtime:
    interface: content
    target: $SNAP/wine-runtime
    default-provider: wine-platform-runtime
  wine-6-stable:
    interface: content
    target: $SNAP/wine-platform
    default-provider: wine-platform-6-stable
